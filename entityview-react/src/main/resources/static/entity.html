<!DOCTYPE html>
<html>
<head>
	<title>React + Spring</title>
</head>
<body>
<div id='root'></div>

<script src="https://fb.me/react-15.0.1.js"></script>
<script src="https://fb.me/react-dom-15.0.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script type="text/babel">
	var App = React.createClass({

		loadEmployeesFromServer: function() {
			var self = this;
			$.ajax({
				url: "http://localhost:8080/entity/repository/"
			}).then(function(data) {
				self.setState({entities: data});
			});
		},
		handleEntitySelect: function(selected) {
			this.setState({selectedEntity: selected});
		},
		updateEntities: function(data) {
			this.setState({entities: data});
		},

		getInitialState: function() {
			return {entities: [], selectedEntity: ""};
		},

		componentDidMount: function() {
			this.loadEmployeesFromServer();
		},

		render() {
			return (
					<div><Entities entities={this.state.entities} handler={this.handleEntitySelect}/><label>bla {this.state.selectedEntity}</label>
					</div>);
		}
	});

	var Entities = React.createClass({
		render: function() {
			var self = this;

			return (
					<div className="dropdown">
						<button className="btn btn-default dropdown-toggle" type="button" id="entitiesDropdown" data-toggle="dropdown"
						        aria-haspopup="true" aria-expanded="false">
							Available Entities
							<span className="caret"></span>
						</button>
						<ul className="dropdown-menu" aria-labelledby="entitiesDropdown">
							{this.props.entities.map(function(d, idx) {
								return (<li id={d}><a href="#"  onClick={() => self.props.handler(d)}>{d}</a></li>)
							})}
						</ul>
					</div>

			)
		}
	});

	var Reload = React.createClass({
		getInitialState() {
			return {
				count: 0
			};
		},
		countUp: function() {
			this.setState({count: this.state.count + 1});
			this.props.updateEntities(this.state.count);
		},

		render: function() {
			return (
					<button onClick={() => this.countUp()}>reload</button>
			)
		}
	});

	ReactDOM.render(<App/>, document.getElementById('root'));


</script>

</body>
</html>